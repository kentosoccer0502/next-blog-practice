# 検索機能でヒットするはずなのに何もヒットしない現象について

はい、**検索がうまく動かない原因**がこの部分にあります。

---

## 問題点

```tsx
router.push(`/?search=${(debouncedSearch.trim)}`)
```

ここで  
`(debouncedSearch.trim)`  
となっており、**関数（trim）自体を文字列として渡してしまっています**。

---

## 正しい書き方

`debouncedSearch.trim()` のように、**trimを実行した値**を渡す必要があります。

---

## 修正例

````tsx
useEffect(() => {
    if (debouncedSearch.trim()) {
        router.push(`/?search=${debouncedSearch.trim()}`)
    } else {
        router.push('/')
    }
}, [debouncedSearch, router])
````

---

### まとめ

- `debouncedSearch.trim` → `debouncedSearch.trim()`
- これで検索クエリが正しくURLに反映され、サーバー側で正しく受け取れるようになります。

この修正で検索が期待通り動くはずです！

--------

# 認証・セッション情報の流れ

[ログインフォーム]
    │
    ▼
[authorize関数]
  │
  ├─ credentialsをzodでバリデーション
  │
  ├─ getUser(email)でDBからユーザー取得
  │
  ├─ パスワード照合（bcryptjs）
  │
  └─ 一致すれば user オブジェクトを返す
    │
    ▼
[NextAuth内部]
  │
  ├─ userオブジェクトからJWT(token)を生成
  │   └─ token.id, token.name, token.email など
  │
  ▼
[callbacks.session]
  │
  ├─ session.user.id = token.id || token.sub
  ├─ session.user.name = token.name
  └─ session.user.email = token.email
    │
    ▼
[クライアントやAPIで session を利用]